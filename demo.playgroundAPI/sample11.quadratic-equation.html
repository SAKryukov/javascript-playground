<!DOCTYPE html><script src="../JavaScript.Playground/playgroundAPI.js"></script><script>

console.info("Solve the equation: Ax² + Bx + C = 0");
writeLine();

const naiveSolution = (A, B, C) => {
    if (A == 0)
        return -C/B;
    const p = B/A;
    const q = C/A;
    const determinant = (p / 2) * (p / 2) - q;
    if (determinant < 0) return [];
    const term = Math.sqrt(determinant);
    return [-p/2 - term, -p/2 + term];
};

class anyNumber extends Set {
    static get [Symbol.species]() { return Set; }
    get size() { return Number.POSITIVE_INFINITY; }
    add(object) {}
    has(element) {  return element != null && element.constructor == Number && !isNaN(element * 0); }
};

const solution = (A, B, C) => {
    if (A == 0 && B == 0 && C == 0)
        return new anyNumber;
    if (A == 0)
        return -C/B;
    const p = B/A;
    const q = C/A;
    const determinant = (p / 2) * (p / 2) - q;
    if (determinant < 0) return [];
    const sign = p > 0 ? -1 : 1;
    const mainRoot = -p/2 + sign * Math.sqrt(determinant);
    return [mainRoot, q / mainRoot];
};

/////// tests, demo: //////////////////////////////////

const show = (A, B, C, taskOnly) => {
    const signA = A >= 0 ? "" : "−";
    const signB = B >= 0 ? "+" : "−";
    const signC = C >=0 ? "+" : "−";
    console.log(`${signA}${Math.abs(A)}x² ${signB} ${Math.abs(B)}x ${signC} ${Math.abs(C)} = 0, solution: `);
    if (taskOnly) return;
    console.log(solution(A, B, C));
    writeLine();
}
show(5, 3, - 2);

show(1, 2, 0);
console.log(solution(0, 2, - 4));
console.log(solution(0, 0, 32));
console.log(solution(0, 0, -4));
const any = solution(0, 0, 0);
console.log(`solution(0, 0, 0): anyNumber = ${solution(0, 0, 0)}, size: ${solution(0, 0, 0).size}`);
console.log(`Any number has 1 = ${any.has(1)}`);
console.log(`Any number has Inf = ${any.has(Number.POSITIVE_INFINITY)}`);
console.log(`Any number has NaN = ${any.has(Number.NaN)}`);
console.log(`Any number has "abc" = ${any.has("abc")}`);

const compare = (A, B, C, comment) => {
    show(A, B, C, true);
    if (comment) console.log(`${comment}:`);
    const naiveLabel = "Naive", goodLabel = "Good";
    const naiveRoots = naiveSolution(A, B, C);
    const goodRoots = solution(A, B, C);
    console.log(`${naiveLabel} roots: ${naiveRoots}`);
    console.log(`${goodLabel} roots: ${goodRoots}`);
    const testTestability = roots => roots =! null && roots.constructor == Array && roots.length == 2;
    const testZeros = zeros => {
        let result = [];
        for (let zero of zeros)
            result.push(A * zero * zero + B * zero + C);
        return `zeroes: ${result}`;
    };
    if (testTestability(naiveRoots) && testTestability(goodRoots)) {
        console.log(naiveLabel, testZeros(naiveRoots));
        console.log(goodLabel, testZeros(goodRoots));
    }
    writeLine();
}; //compare

writeLine();

compare(1, 6, 0.0001, "Better accuracy"); // demonstrates better accuracy
compare(5, 3, - 2); // demonstrates better accuracy
compare(5, - 3, - 2); // demonstrates better accuracy
compare(1, -4, 3);
compare(1 / 2, - 3, 1); // demonstrates better accuracy
compare(1, -6, 9); // equal
compare(2, -14, 12); // equal
compare(2, -1, -15);
compare(8, -6, 1);
compare(9, -6, 1); // equal
compare(3, - 1, 2); // none

</script><script>showSample("Quadratic Equation", false, true);</script>